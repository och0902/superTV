<%/*
   article
   comment
   commentForm
   commentError
*/%>

<div class="border-top">
   <% if(comment.isDeleted){ %>
      <div class="text-muted p-2">(Deleted Comment)</div>
   <% } else { %>
      <div class="row pt-1 pb-1">
         <div class="col-3 col-md-2 col-lg-1 pl-4"><%= comment.writer.emailId %></div>
         <div id="comment-<%= comment._id %>" class="col-9 col-md-10 col-lg-11 <%= (commentError._id == comment._id)?'comment-edit-enabled':'' %> <%= (commentError.parentComment == comment._id)?'comment-reply-enabled':'' %>">
            <div class="comment-show">
               <div class="comment-text mb-3"><%= comment.text %></div>
               <small class="d-block">
                  등록일시: <span data-date-time="<%= comment.createdAt %>"></span>
                  <% if(comment.updatedAt){ %>
                  | 수정일시: <span data-date-time="<%= comment.updatedAt %>"></span>
                  <% } %>
                  | 
                  <% if(isAuthenticated){ %>
                     <a href="javascript:void(0)" onclick="$('.comment-reply-enabled').removeClass('comment-reply-enabled'); $('.comment-edit-enabled').removeClass('comment-edit-enabled'); $('#comment-<%= comment._id %>').addClass('comment-reply-enabled')" class="text-decoration-none text-dark"><span class="text-underline-hover">대댓글</span></a>
                     <% if(comment.writer && currentUser.id == comment.writer.id){ %>
                        |
                        <a href="javascript:void(0)" onclick="$('.comment-reply-enabled').removeClass('comment-reply-enabled'); $('.comment-edit-enabled').removeClass('comment-edit-enabled'); $('#comment-<%= comment._id %>').addClass('comment-edit-enabled')" class="text-decoration-none text-dark"><span class="text-underline-hover">수정</span></a>
                        |
                        <form action="/comments/<%= comment._id %>?articleId=<%= article._id %>&_method=delete<%= getArticleQueryString(true) %>" method="post" class="d-inline">
                           <a href="javascript:void(0)" onclick="confirm('이 댓글을 지울까요 ?')?this.parentElement.submit():null;" class="text-decoration-none text-dark"><span class="text-underline-hover">삭제</span></a>
                        </form>
                     <% } %>
                  <% } %>
               </small>
            </div>
            <div class="comment-edit">
               <%- include('./commentForm', {
                  actionUrl:'/comments/' + comment._id + '?articleId=' + article._id + '&_method=put',
                  comment: comment,
                  commentForm: commentForm,
                  commentError: commentError,
                  parentComment: null,
               }); %>
            </div>
            <div class="comment-reply">
               <%- include('./commentForm', {
                  actionUrl:'/comments?articleId=' + article._id,
                  comment: {},
                  commentForm: commentForm,
                  commentError: commentError,
                  parentComment: comment._id,
               }); %>
            </div>
         </div>
      </div>
   <% } %>

   <div class="ml-3">
      <% if(comment.childComments){ %>
         <% comment.childComments.forEach(function(childComment) { %>
         <%- include('./showComment', {
            article: article,
            comment: childComment,
            commentForm: commentForm,
            commentError: commentError,
         }); %>
         <% }) %>
      <% } %>
   </div>

</div>
