<!DOCTYPE html>
<html lang="ko">
   <head>
      <%- include('../partials/head') %>
   </head>
   <body>
      <%- include('../partials/nav') %>
      <div class="container mb-3">

         <div class="row">
            <div class="col-md-8">
               <h4>Article</h4>
               <p>다양한 여러의견들이 제안되고 논의되는 <strong>자유롭고 건강한 공간</strong></pclass=>
            </div>

            <div class="d-flex col-md-4 justify-content-end align-items-center">
               <a class="btn btn-light border text-underline-hover me-1" href="/articles<%= getArticleQueryString() %>">뒤로</a>
               <% if(isAuthenticated && article.writer && currentUser.id == article.writer.id){ %>
                  <a class="btn btn-light border text-underline-hover mx-1" href="/articles/<%= article._id %>/edit<%= getArticleQueryString() %>">수정</a>
                  <form action="/articles/<%= article._id %>?_method=delete<%= getArticleQueryString(true) %>" method="post" class="d-inline">   
                     <a class="btn btn-light border text-underline-hover ms-1" href="#" onclick="confirm('이 글을 지울까요 ?')?this.parentElement.submit():null;">삭제</a>
                  </form>
               <% } %>
            </div>

         </div>

         <div class="mt-2">
            <h5 class="card-header p-2" data-search-highlight="title">[<%= article.numId %>] <%= article.title %></h5>

            <div class="row">
               <div class="col-md-7 col-lg-8 col-xl-9 order-sm-2 order-md-1">
                  <div class="article-content p-2" data-search-highlight="content"><%= article.content %></div>
               </div>

               <div class="col-md-5 col-lg-4 col-xl-3 order-sm-1 order-md-2">
                  <div class="article-info card m-2 p-2">
                     <div class="border-bottom pb-1 mb-1">
                        <span>작성자</span> : <span data-search-highlight="writer"><%= article.writer ? article.writer.emailId : "" %></span>
                        <span> | 조회수</span> : <span><%= article.views %></span>
                     </div>
                     <div><span>등록일시</span> : <span data-date-time="<%= article.createdAt %>"></span></div>
                     <% if(article.updatedAt) { %>
                        <div><span>수정일시</span> : <span data-date-time="<%= article.updatedAt %>"></span></div>
                     <% } %>
                  </div>
               </div>

            </div>
         </div>

         <h4 class="mt-3">댓 글</h4>

         <% if(commentTrees.length){ %>
            <div class="mt-3 border-bottom">
               <% commentTrees.forEach(function(comment) { %>
                  <%- include('./partials/showComment', {
                     article: article,
                     comment: comment,
                     commentForm: commentForm,
                     commentError: commentError,
                  }); %>
               <% }) %>
            </div>
         <% } %>

         <div class="mt-3">
            <%- include('./partials/commentForm', {
               actionUrl:'/comments?articleId=' + article._id,
               comment: {},
               commentForm: commentForm,
               commentError: commentError,
               parentComment: null,
            }); %>
         </div>

      </div>
   </body>
</html>
