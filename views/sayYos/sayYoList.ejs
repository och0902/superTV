<!DOCTYPE html>
<html lang="ko">
   <head>
      <%- include('../partials/head') %>
   </head>
   <body>
      <%- include('../partials/nav') %>
      <div class="container">

         <div class="row">
            <div class="col-md-8">
               <h4>Say Yo !!!</h4>
               <p>다양한 여러의견들이 제안되고 논의되는 <strong>자유롭고 건강한 공간</strong></pclass=>
            </div>
            <div class="d-flex col-md-4 justify-content-end align-items-center">
               <a href="/sayYos/new<%= getArticleQueryString() %>"><span class="btn btn-light border text-underline-hover">새글 작성</span></a>
            </div>
         </div>
 
         <table class="table table-responsive-lg table-hover mt-2">
            <thead class="table-light">
               <tr>
                  <th scope="col" class="col-1 text-center">번 호</th>
                  <th scope="col" class="col-2 text-center">카테고리</th>
                  <th scope="col" class="col-4 title">제 목</th>
                  <th scope="col" class="col-1 text-center">작성자</th>
                  <th scope="col" class="col-2 text-center">등록일</th>
                  <th scope="col" class="col-1 text-center">댓글수</th>
                  <th scope="col" class="col-1 text-center">조회수</th>
               </tr>
            </thead>
            <tbody>
               <% if(sayYos == null || sayYos.length == 0){ %>
                  <tr>
                     <td colspan=5> There is no data to show :( </td>
                  </tr>
               <% } %>
               <% sayYos.forEach(function(sayYo) { %>
                  <tr>
                     <td class="col-1 text-center"><%= sayYo.numId %></td>
                     <td class="col-2 text-center"><%= sayYo.category %></td>
                     <td class="col-4">
                        <a href="/sayYos/<%= sayYo._id %><%= getArticleQueryString() %>" class="text-dark text-decoration-none">
                           <div data-search-highlight="title" class="title-ellipsis ellipsis">
                              <span class="title-text text-underline-hover"><%= sayYo.title %></span>
                           </div>
                        </a>
                     </td>
                     <td class="col-1 text-center">
                        <a class="text-dark text-decoration-none" href="/sayYos<%= getArticleQueryString(false, { searchType:'writer!', searchText:sayYo.writer.emailId }) %>">
                           <div data-search-highlight="writer" class="ellipsis">
                              <span class="text-underline-hover"><%= sayYo.writer ? sayYo.writer.emailId : "" %></span>
                           </div>
                        </a>
                     </td>                     
                     <td class="col-2 text-center">
                        <span data-date="<%= sayYo.createdAt %>"><%= sayYo.createdAt %></span>
                     </td>    
                     <td class="col-1 text-center"><%= sayYo.sayYoCommentCount %></td>
                     <td class="col-1 text-center"><%= sayYo.views %></td>
                  </tr>
               <% }) %>
            </tbody>
         </table>

         <form class="row d-flex g-2" action="/sayYos" method="get" class="sayYo-index-tool">
            <div class="col-md-3">
               <div class="input-group">
                  <span class="btn border">보 기</span>
                  <select class="form-select" name="limit" onchange="this.parentElement.parentElement.parentElement.submit()">
                     <option value="5" <%= limit==5?'selected':'' %>>5개</option>
                     <option value="10" <%= limit==10?'selected':'' %>>10개</option>
                     <option value="20" <%= limit==20?'selected':'' %>>20개</option>
                  </select>
               </div>
            </div>

            <div class="col-md-6">
               <div class="input-group">
                  <select class="form-select" name="searchType">
                     <option value="title, content" <%= searchType=='title, content'?'selected':'' %>>제목, 내용</option>
                     <option value="title" <%= searchType=='title'?'selected':'' %>>제목</option>
                     <option value="content" <%= searchType=='content'?'selected':'' %>>내용</option>
                     <option value="writer" <%= searchType=='writer'?'selected':'' %>>작성자</option>
                  </select>
                  <input class="border" minLength="3" type="text" name="searchText" value="<%= searchText %>">
                  <button class="btn btn-light border text-underline-hover" type="submit">검색하기</button>
               </div>

            </div>

            <div class="col-md-3 d-flex justify-content-end">
               <% 
                  var offset = 2;
                  var previousBtnEnabled = currentPage>1;
                  var nextBtnEnabled = currentPage<maxPage;
               %>
               <ul class="pagination pagination-md justify-content-center align-items-center h-100 mb-0">
                  <li class="page-item <%= previousBtnEnabled?'':'disabled' %>">
                     <a class="page-link" href="/sayYos<%= getArticleQueryString(false, {page:currentPage-1}) %>" <%= previousBtnEnabled?'':'tabindex=-1' %>>«</a>
                  </li>
                  <% for(i=1;i<=maxPage;i++){ %>
                     <% if(i==1 || i==maxPage || (i>=currentPage-offset && i<=currentPage+offset)){ %>
                        <li class="page-item <%= currentPage==i?'active':'' %>"><a class="page-link" href="/sayYos<%= getArticleQueryString(false, {page:i}) %>"> <%= i %> </a></li>
                     <% } else if(i==2 || i==maxPage-1){ %>
                        <li><a class="page-link">...</a></li>
                     <% } %>
                  <% } %>
                  <li class="page-item <%= nextBtnEnabled?'':'disabled' %>">
                     <a class="page-link" href="/sayYos<%= getArticleQueryString(false, {page:currentPage+1}) %>" <%= nextBtnEnabled?'':'tabindex=-1' %>>»</a>
                  </li>
               </ul>
            </div>

         </form>

      </div>
   </body>
</html>
